<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace = "~{fragments::header}"></head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <!-- Sidebar -->
        <ul th:fragment="sidebar" class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" th:href="@{/index}">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Trendy Threads <sup></sup></div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item active">
                <a class="nav-link" th:href="@{/index}">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                Interface
            </div>

<!--            &lt;!&ndash; Nav Item - Pages Collapse Menu &ndash;&gt;-->
<!--            <li class="nav-item">-->
<!--                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo"-->
<!--                   aria-expanded="true" aria-controls="collapseTwo">-->
<!--                    <i class="fas fa-fw fa-cog"></i>-->
<!--                    <span>Components</span>-->
<!--                </a>-->
<!--                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">-->
<!--                    <div class="bg-white py-2 collapse-inner rounded">-->
<!--                        <h6 class="collapse-header">Custom Components:</h6>-->
<!--                        <a class="collapse-item" href="categories.html" th:href="@{/categories}">Manage Category</a>-->
<!--                        <a class="collapse-item" href="cards.html" th:href="@{/products}">Manage Products</a>-->
<!--                        <a class="collapse-item" href="cards.html" th:href="@{/users}">Manage Users</a>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </li>-->

            <!-- Nav Item - Category -->
            <li class="nav-item">
                <a class="nav-link" th:href="@{/categories}">
                    <i class="fas fa-fw fa-cog"></i>
                    <span>Category</span></a>
            </li>

            <!-- Nav Item - Products -->
            <li class="nav-item">
                <a class="nav-link" th:href="@{/products}">
                    <i class="fas fa-fw fa-luggage-cart"></i>
                    <span>Products</span></a>
            </li>

            <!-- Nav Item - Users -->
            <li class="nav-item">
                <a class="nav-link" th:href="@{/users}">
                    <i class="fas fa-fw fa-id-card"></i>
                    <span>Users</span></a>
            </li>

            <!-- Nav Item - Orders -->
            <li class="nav-item">
                <a class="nav-link" th:href="@{/orders}">
                    <i class="fas fa-fw fa-chart-area"></i>
                    <span>Orders</span></a>
            </li>

            <!-- Nav Item - Coupons -->
            <li class="nav-item">
                <a class="nav-link" th:href="@{/coupons}">
                    <i class="fas fa-fw fa-receipt"></i>
                    <span>Coupons</span></a>
            </li>

            <!-- Nav Item - Offers -->
            <li class="nav-item">
                <a class="nav-link" th:href="@{/offers}">
                    <i class="fas fa-fw fa-gift"></i>
                    <span>Offers</span></a>
            </li>

            <!-- Nav Item - Sales Report -->
            <li class="nav-item">
                <a class="nav-link" th:href="@{/salesReport}">
                    <i class="fas fa-fw fa-receipt"></i>
                    <span>Sales Report</span></a>
            </li>


            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>



        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Top bar -->
                <nav th:replace="~{fragments :: topbar} "></nav>
                <!-- End of Top bar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">


                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
<!--                        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i-->
<!--                                class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>-->
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                Earnings (Current Month) : <span th:text="${currentMonth}"></span></div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800"><span>₹</span> <span th:text="${currentMonthEarning}"></span></div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Earnings (Current Year) : <span th:text="${currentYear}"></span><br></div>
                                            <div class="h4 mb-0 font-weight-bold text-gray-800"><span>₹</span><span th:text="${currentYearlyEarning}"></span></div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pending Requests Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                Total Orders</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" th:text="${totalOrders}">18</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-comments fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Orders Pending
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800" th:text="${totalPendingOrders}"></div>
                                                </div>
                                                <div class="col">
                                                    <div class="progress progress-sm mr-2">
                                                        <div class="progress-bar bg-info" role="progressbar"
                                                             th:style="'width: ' + ${progress} + '%'"
                                                             aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>

                    <!-- Content Row -->

                    <div class="row">


                        <!-- Area Chart -->
                        <div class="col-xl-8 col-lg-7">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                        class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Daily Earnings Overview in Current Month:<span th:text="${currentMonth}"></span></h6>
                                    <div class="dropdown no-arrow">
<!--                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"-->
<!--                                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-->
<!--                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>-->
<!--                                        </a>-->


                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body" th:attr="data-daily-earnings=${dailyEarnings}">
                                    <div class="chart-area" >
                                        <canvas id="myDailyEarningsChart" width="600" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Area Chart End-->


                        <!-- Pie Chart -->
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4" id="paymentMethodPieChart">
                                <!-- Card Header - Dropdown -->
                                <div
                                        class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Revenue - Payment Methods</h6>

                                </div>
                                <div class="card-body" th:attr="data-totalPrice-byPayment=${totalPriceByPayment}" style="height: 360px;">
                                    <div class="chart-pie pt-4 pb-2 ">
                                        <canvas id="myPieChart" height="200"></canvas>
                                    </div>

                                </div>


                            </div>
                        </div>
                        <!-- Pie Chart End -->


                    </div>
                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer th:replace="~{fragments :: footer}"></footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

        </ul>
        </div>
    <!-- End of Page Wrapper -->

    <div th:replace="~{/fragments :: scroll}"></div>
    <div th:replace="~{fragments :: script}"></div>
    <script th:src="@{/vendor/chart.js/Chart.min.js}"></script>
    <script th:src="@{/js/demo/chart-area-demo.js}"></script>


    <script>
        var encodedDataElement = document.querySelector('[data-daily-earnings]');
        if (encodedDataElement) {
            var encodedData = encodedDataElement.getAttribute('data-daily-earnings');
            var decodedData = decodeEntities(encodedData);

            // Now you can parse the JSON data
            var jsonData = JSON.parse(decodedData);

            // Extract dates and earnings from the data
            var dates = jsonData.map(function(item) {
                // Convert the "date" property to a Date object
                var date = new Date(item.date);
                // Format the date to display only the day
                var formattedDate = date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
                return formattedDate;
            });

            var earnings = jsonData.map(function(item) {
                return item.earnings; // Extract the "earnings" property
            });

            // Create a chart using Chart.js
            var ctx = document.getElementById("myDailyEarningsChart").getContext('2d');

            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: "Daily Earnings in Rs.",
                        data: earnings,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: true,
                    }]
                },
                options: {
                    scales: {
                        x: {
                            beginAtZero: true
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        } else {
            console.log('Element with data-daily-earnings attribute not found.');
        }

        function decodeEntities(encodedString) {
            var textArea = document.createElement('textarea');
            textArea.innerHTML = encodedString;
            return textArea.value;
        }
    </script>



    <script>
        var backgroundColor = [
            'rgba(255, 99, 132, 0.7)',  // Light Red
            'rgba(75, 192, 192, 0.7)', // Light Green
            'rgba(255, 206, 86, 0.7)', // Light Yellow
        ];
        var encodedDataElement = document.querySelector('[data-totalPrice-byPayment]');
        var encodedData = encodedDataElement.getAttribute('data-totalPrice-byPayment');
        var decodedData = decodeEntities(encodedData);

        // Now you can parse the JSON data
        var jsonData = JSON.parse(decodedData);

        var labels = jsonData.map(function(item) {
            return item.payMethod;
        });

        var data = jsonData.map(function(item) {
            return item.amount;
        });

        var ctx = document.getElementById('myPieChart').getContext('2d');

        var myPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColor,
                }]
            },
            options: {
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem, data) {
                            var dataset = data.datasets[0];
                            var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
                                return previousValue + currentValue;
                            });
                            var currentValue = dataset.data[tooltipItem.index];
                            var percentage = Math.round((currentValue / total) * 100);
                            return percentage + "%";
                        }
                    }
                }
            }
        });

    </script>








</body>

</html>